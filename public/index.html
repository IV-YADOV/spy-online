<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>–®–ø–∏–æ–Ω –û–Ω–ª–∞–π–Ω</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
</head>
<body>

    <div class="mesh-background"></div>
    
    <div id="toast-notification" class="toast"></div>

    <div class="app-wrapper">
        <div class="app-container">
            
            <div id="screen-login" class="screen active">
                <div class="header-large center-text">
                    <h1>–®–ø–∏–æ–Ω</h1>
                    <p class="subtitle">–û–Ω–ª–∞–π–Ω</p>
                </div>
                <div class="glass-panel">
                    <div class="input-group">
                        <i class="ph-bold ph-user"></i>
                        <input type="text" id="username" placeholder="–í–∞—à–µ –∏–º—è" maxlength="12">
                    </div>
                </div>
                <button class="main-btn" onclick="createGame()">
                    –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É <i class="ph-bold ph-plus-circle"></i>
                </button>
                <div class="join-row">
                    <div class="glass-panel small-input">
                        <input type="text" id="room-code-input" placeholder="CODE" style="text-transform:uppercase; text-align:center;">
                    </div>
                    <button class="secondary-btn" onclick="joinGame()">
                        –í–æ–π—Ç–∏ <i class="ph-bold ph-arrow-right"></i>
                    </button>
                </div>
            </div>

            <div id="screen-lobby" class="screen">
                <div class="top-bar">
                    <button class="icon-btn" onclick="exitGame()"><i class="ph-bold ph-caret-left"></i> –í—ã—Ö–æ–¥</button>
                    <div class="room-tag">–ö–æ–º–Ω–∞—Ç–∞: <span id="display-code">...</span></div>
                </div>

                <div class="section-title">–ò–≥—Ä–æ–∫–∏</div>
                <div class="players-grid" id="players-list"></div>

                <div class="section-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                <div class="glass-panel settings-box">
                    <div class="control-row">
                        <div class="label-box"><i class="ph-fill ph-sunglasses icon-red"></i> –®–ø–∏–æ–Ω–æ–≤</div>
                        <div class="value-control host-only-control">
                            <button onclick="changeSetting('spies', -1)">-</button>
                            <span id="val-spies">1</span>
                            <button onclick="changeSetting('spies', 1)">+</button>
                        </div>
                        <div class="value-display guest-only-control"><span id="guest-spies">1</span></div>
                    </div>
                    <div class="divider"></div>
                    <div class="control-row">
                        <div class="label-box"><i class="ph-fill ph-hourglass-high icon-blue"></i> –ú–∏–Ω—É—Ç—ã</div>
                        <div class="value-control host-only-control">
                            <button onclick="changeSetting('time', -1)">-</button>
                            <span id="val-time">5</span>
                            <button onclick="changeSetting('time', 1)">+</button>
                        </div>
                        <div class="value-display guest-only-control"><span id="guest-time">5</span> –º–∏–Ω</div>
                    </div>
                    <div class="divider"></div>
                    <div class="control-row" onclick="openFilterModal()" style="cursor: pointer;">
                        <div class="label-box"><i class="ph-fill ph-faders"></i> –õ–æ–∫–∞—Ü–∏–∏</div>
                        <div style="display:flex; align-items:center; gap:5px; color:var(--text-muted); font-size:0.9rem;">
                            <span id="active-loc-count">20</span> –≤ –∏–≥—Ä–µ <i class="ph-bold ph-caret-right"></i>
                        </div>
                    </div>
                </div>

                <div id="lobby-status" class="status-text guest-only-control">–û–∂–∏–¥–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞...</div>
                <button id="start-btn" class="main-btn floating-btn host-only-control" onclick="startGame()">
                    –ù–∞—á–∞—Ç—å –∏–≥—Ä—É <i class="ph-bold ph-play"></i>
                </button>
            </div>

            <div id="screen-game" class="screen">
                <div class="timer-container">
                    <svg class="progress-ring" width="120" height="120">
                        <circle class="progress-ring__circle" stroke="currentColor" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/>
                    </svg>
                    <div class="timer-text" id="timer-display">05:00</div>
                </div>

                <div class="card-area" onclick="flipCard()">
                    <div class="game-card" id="game-card">
                        <div class="card-face front">
                            <div class="pattern-circle"><i class="ph-duotone ph-fingerprint"></i></div>
                            <p>–ù–∞–∂–º–∏—Ç–µ,<br>—á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Ä–æ–ª—å</p>
                        </div>
                        <div class="card-face back">
                            <div class="role-content">
                                <h2 id="role-text">–†–æ–ª—å</h2>
                                <div class="location-badge">
                                    <i class="ph-fill ph-map-pin"></i> <span id="location-text">–õ–æ–∫–∞—Ü–∏—è</span>
                                </div>
                                <p class="role-desc" id="role-desc">...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="game-actions">
                    <button id="spy-guess-btn" class="action-btn hidden" onclick="openSpyGuess()">
                        <i class="ph-bold ph-crosshair"></i> –£–≥–∞–¥–∞—Ç—å
                    </button>
                    <button class="action-btn" onclick="openVoteMenu()">
                        <i class="ph-bold ph-gavel"></i> –ö–∏–∫–Ω—É—Ç—å
                    </button>
                </div>

                <div class="menu-grid">
                    <div class="menu-item" onclick="openGameList()">
                        <span class="menu-icon icon-bg-blue"><i class="ph-fill ph-list-dashes"></i></span>
                        <span>–°–ø–∏—Å–æ–∫</span>
                    </div>
                    <div class="menu-item host-only-control" onclick="restartGameReq()">
                        <span class="menu-icon icon-bg-red"><i class="ph-fill ph-stop"></i></span>
                        <span>–ó–∞–≤–µ—Ä—à–∏—Ç—å</span>
                    </div>
                </div>
            </div>

            <div id="screen-results" class="screen">
                <div style="flex:1; display:flex; flex-direction:column; justify-content:center; text-align:center;">
                    <div id="res-icon" class="result-icon">üèÜ</div>
                    <h1 id="res-title">–ü–æ–±–µ–¥–∞!</h1>
                    <p id="res-reason" class="result-reason">–ü—Ä–∏—á–∏–Ω–∞ –ø–æ–±–µ–¥—ã</p>
                    
                    <div class="glass-panel result-box">
                        <div class="res-row">
                            <span>–õ–æ–∫–∞—Ü–∏—è:</span>
                            <b id="res-loc">–ü–ª—è–∂</b>
                        </div>
                        <div class="divider"></div>
                        <div class="res-row">
                            <span>–®–ø–∏–æ–Ω:</span>
                            <b id="res-spy" style="color:var(--accent)">–ò–º—è</b>
                        </div>
                    </div>
                </div>
                <button class="main-btn host-only-control" onclick="restartGameReq()">–í –ª–æ–±–±–∏</button>
                <p class="status-text guest-only-control">–ñ–¥–µ–º —Ö–æ—Å—Ç–∞...</p>
            </div>

            <div id="filter-sheet" class="bottom-sheet">
                <div class="sheet-header">
                    <h3>–§–∏–ª—å—Ç—Ä –ª–æ–∫–∞—Ü–∏–π</h3>
                    <button class="close-btn" onclick="closeSheets()"><i class="ph-bold ph-x"></i></button>
                </div>
                <div class="sheet-content">
                    <ul id="filter-list" class="toggle-list"></ul>
                </div>
            </div>

            <div id="game-list-sheet" class="bottom-sheet">
                <div class="sheet-header">
                    <h3>–í–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Å—Ç–∞</h3>
                    <button class="close-btn" onclick="closeSheets()"><i class="ph-bold ph-x"></i></button>
                </div>
                <div class="sheet-content">
                    <ul id="game-check-list" class="check-list"></ul>
                </div>
            </div>

            <div id="vote-menu-sheet" class="bottom-sheet">
                <div class="sheet-header">
                    <h3>–ö–æ–≥–æ –≤—ã–≥–Ω–∞—Ç—å?</h3>
                    <button class="close-btn" onclick="closeSheets()"><i class="ph-bold ph-x"></i></button>
                </div>
                <div class="sheet-content">
                    <p class="hint-text">–ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–≥–æ–ª–æ—Å—É—é—Ç –ó–ê ‚Äî –∏–≥—Ä–æ–∫ –≤—ã–±—ã–≤–∞–µ—Ç –∏ –≤—Å–∫—Ä—ã–≤–∞–µ—Ç —Ä–æ–ª—å.</p>
                    <ul id="vote-list" class="simple-list"></ul>
                </div>
            </div>

            <div id="spy-guess-sheet" class="bottom-sheet">
                <div class="sheet-header">
                    <h3>–ì–¥–µ –º—ã?</h3>
                    <button class="close-btn" onclick="closeSheets()"><i class="ph-bold ph-x"></i></button>
                </div>
                <div class="sheet-content">
                    <p class="hint-text">–û—à–∏–±–∫–∞ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –ø–æ—Ä–∞–∂–µ–Ω–∏—é!</p>
                    <ul id="spy-guess-list" class="simple-list"></ul>
                </div>
            </div>

            <div id="vote-popup" class="modal-overlay">
                <div class="modal-box">
                    <h3>–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ!</h3>
                    <p>–í—ã–≥–Ω–∞—Ç—å –∏–≥—Ä–æ–∫–∞ <b id="vote-target-name">–ò–º—è</b>?</p>
                    <div class="modal-actions">
                        <button class="main-btn" onclick="sendVote(true)" style="background:var(--accent)">–î–∞ (–ö–∏–∫–Ω—É—Ç—å)</button>
                        <button class="secondary-btn" onclick="sendVote(false)">–ù–µ—Ç</button>
                    </div>
                </div>
            </div>

            <div id="confirm-popup" class="modal-overlay">
                <div class="modal-box">
                    <h3 id="confirm-title">–í–Ω–∏–º–∞–Ω–∏–µ</h3>
                    <p id="confirm-text">–í—ã —É–≤–µ—Ä–µ–Ω—ã?</p>
                    <div class="modal-actions">
                        <button id="confirm-yes-btn" class="main-btn" style="background:var(--accent)">–î–∞</button>
                        <button class="secondary-btn" onclick="closeConfirmPopup()">–ù–µ—Ç</button>
                    </div>
                </div>
            </div>
            
            <div id="modal-backdrop" class="backdrop" onclick="closeSheets()"></div>

        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="script.js"></script>
</body>
</html>